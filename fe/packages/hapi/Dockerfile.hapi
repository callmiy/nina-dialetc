FROM nina-js-commons

ARG NODE_ENV

ENV \
BACKEND_APP="hp" \
  NODE_ENV=$NODE_ENV \
  NINA_APP_NAME=hapi

USER node

WORKDIR /home/node/app

# COMMONS
COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/commons/node_modules \
  ./packages/commons/node_modules

COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/commons \
  ./packages/commons

# DATA
COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/data/node_modules \
  ./packages/data/node_modules

COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/data \
  ./packages/data

# DB-MIGRATIONS
COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/db-migrations/node_modules \
  ./packages/db-migrations/node_modules

COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/db-migrations \
  ./packages/db-migrations

# HAPI
COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/hapi/node_modules \
  ./packages/hapi/node_modules

COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/hapi \
  ./packages/hapi

# PG-PROMISE
COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/pg-promise/node_modules \
  ./packages/pg-promise/node_modules

COPY --from=nina-js-base --chown=node:node \
  /home/node/app/packages/pg-promise \
  ./packages/pg-promise

CMD ["/bin/bash"]